
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ruuvi_driver_error.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#ifndef RUUVI_DRIVER_ERROR_H</a>
<a name="ln2">#define RUUVI_DRIVER_ERROR_H</a>
<a name="ln3">/**</a>
<a name="ln4"> * @defgroup Error Error reporting and handling</a>
<a name="ln5"> * @brief Functions and definitions for errors and error handling</a>
<a name="ln6"> *</a>
<a name="ln7"> */</a>
<a name="ln8">/** @{ */</a>
<a name="ln9">/**</a>
<a name="ln10"> * @file ruuvi_driver_error.h</a>
<a name="ln11"> * @author Otso Jousimaa</a>
<a name="ln12"> * @date 2020-05-20</a>
<a name="ln13"> * @copyright Ruuvi Innovations Ltd, license BSD-3-Clause</a>
<a name="ln14"> * @brief Ruuvi error codes and error check function</a>
<a name="ln15"> *</a>
<a name="ln16"> */</a>
<a name="ln17"> </a>
<a name="ln18">#include &lt;float.h&gt;</a>
<a name="ln19">#include &lt;math.h&gt;</a>
<a name="ln20">#include &lt;stdbool.h&gt;</a>
<a name="ln21">#include &lt;stdint.h&gt;</a>
<a name="ln22"> </a>
<a name="ln23">#define RD_FLOAT_INVALID  NAN            //!&lt; Signal that value should not be used.</a>
<a name="ln24">#define RD_UINT64_INVALID UINT64_MAX     //!&lt; Signal that value should not be used.</a>
<a name="ln25">#define RD_INT64_INVALID  INT64_MIN      //!&lt; Signal that value should not be used.</a>
<a name="ln26">#define RD_INT32_INVALID  INT32_MIN      //!&lt; Signal that value should not be used.</a>
<a name="ln27"> </a>
<a name="ln28">#define RD_SUCCESS                (0U)       ///&lt; Internal Error</a>
<a name="ln29">#define RD_ERROR_INTERNAL         (1U&lt;&lt;0U)   ///&lt; Internal Error</a>
<a name="ln30">#define RD_ERROR_NO_MEM           (1U&lt;&lt;1U)   ///&lt; No Memory for operation</a>
<a name="ln31">#define RD_ERROR_NOT_FOUND        (1U&lt;&lt;2U)   ///&lt; Not found</a>
<a name="ln32">#define RD_ERROR_NOT_SUPPORTED    (1U&lt;&lt;3U)   ///&lt; Not supported</a>
<a name="ln33">#define RD_ERROR_INVALID_PARAM    (1U&lt;&lt;4U)   ///&lt; Invalid Parameter</a>
<a name="ln34">#define RD_ERROR_INVALID_STATE    (1U&lt;&lt;5U)   ///&lt; Invalid state, operation disallowed in this state</a>
<a name="ln35">#define RD_ERROR_INVALID_LENGTH   (1U&lt;&lt;6U)   ///&lt; Invalid Length</a>
<a name="ln36">#define RD_ERROR_INVALID_FLAGS    (1U&lt;&lt;7U)   ///&lt; Invalid Flags</a>
<a name="ln37">#define RD_ERROR_INVALID_DATA     (1U&lt;&lt;8U)   ///&lt; Invalid Data</a>
<a name="ln38">#define RD_ERROR_DATA_SIZE        (1U&lt;&lt;9U)   ///&lt; Invalid Data size</a>
<a name="ln39">#define RD_ERROR_TIMEOUT          (1U&lt;&lt;10U)  ///&lt; Operation timed out</a>
<a name="ln40">#define RD_ERROR_NULL             (1U&lt;&lt;11U)  ///&lt; Null Pointer</a>
<a name="ln41">#define RD_ERROR_FORBIDDEN        (1U&lt;&lt;12U)  ///&lt; Forbidden Operation</a>
<a name="ln42">#define RD_ERROR_INVALID_ADDR     (1U&lt;&lt;13U)  ///&lt; Bad Memory Address</a>
<a name="ln43">#define RD_ERROR_BUSY             (1U&lt;&lt;14U)  ///&lt; Busy</a>
<a name="ln44">#define RD_ERROR_RESOURCES        (1U&lt;&lt;15U)  ///&lt; Not enough resources for operation</a>
<a name="ln45">#define RD_ERROR_NOT_IMPLEMENTED  (1U&lt;&lt;16U)  ///&lt; Not implemented yet</a>
<a name="ln46">#define RD_ERROR_SELFTEST         (1U&lt;&lt;17U)  ///&lt; Self-test fail</a>
<a name="ln47">#define RD_STATUS_MORE_AVAILABLE  (1U&lt;&lt;18U)  ///&lt; Driver has more data queued</a>
<a name="ln48">#define RD_ERROR_NOT_INITIALIZED  (1U&lt;&lt;19U)  ///&lt; Driver is not initialized.</a>
<a name="ln49">#define RD_ERROR_NOT_ACKNOWLEDGED (1U&lt;&lt;20U)  ///&lt; Ack was expected but not received</a>
<a name="ln50">#define RD_ERROR_NOT_ENABLED      (1U&lt;&lt;21U)  ///&lt; Driver is not enabled</a>
<a name="ln51">#define RD_WARNING_DEPRECATED     (1U&lt;&lt;22U)  ///&lt; Deprecated function, warn user.</a>
<a name="ln52">#define RD_ERROR_FATAL            (1U&lt;&lt;31U)  ///&lt; Program should always reset after this</a>
<a name="ln53"> </a>
<a name="ln54">typedef uint32_t rd_status_t; ///&lt; bitfield for representing errors</a>
<a name="ln55"> </a>
<a name="ln56">/**</a>
<a name="ln57"> * @brief Check given error code and compare it to non-fatal errors.</a>
<a name="ln58"> *</a>
<a name="ln59"> * If error is considered fatal (or not non-fatal), reset the device</a>
<a name="ln60"> * If the error is non-fatal, log an error on the console and return</a>
<a name="ln61"> * Resetting requires that @c APPLICATION_POWER_ENABLED evaluates to true and is implemented on platform.</a>
<a name="ln62"> * Logging requires that @c APPLICATION_LOG_ENABLED evaluates to true and is implemented on platform.</a>
<a name="ln63"> *</a>
<a name="ln64"> * @param[in] error error code, might have several flags in it.</a>
<a name="ln65"> * @param[in] non_fatal_mask Signal that this error is acceptable for program flow and execution may continue.</a>
<a name="ln66"> * @param[in] p_file file from which function was called</a>
<a name="ln67"> * @param[in] line line from which the function was called</a>
<a name="ln68"> **/</a>
<a name="ln69">void rd_error_check (const rd_status_t error,</a>
<a name="ln70">                     const rd_status_t non_fatal_mask, const char * p_file, const int line);</a>
<a name="ln71"> </a>
<a name="ln72">/**</a>
<a name="ln73"> * @brief Shorthand macro for calling the @ref rd_error_check with current file &amp; line</a>
<a name="ln74"> *</a>
<a name="ln75"> * If error is considered fatal (or not non-fatal), reset the device</a>
<a name="ln76"> * If the error is non-fatal, log an error on the console and return</a>
<a name="ln77"> * Resetting requires that @c APPLICATION_POWER_ENABLED evaluates to true and is implemented on platform.</a>
<a name="ln78"> * Logging requires that @c APPLICATION_LOG_ENABLED evaluates to true and is implemented on platform.</a>
<a name="ln79"> *</a>
<a name="ln80"> * @param[in] error error code, might have several flags in it.</a>
<a name="ln81"> * @param[in] mask Signal that this error is acceptable for program flow and execution may continue.</a>
<a name="ln82"> **/</a>
<a name="ln83">#define RD_ERROR_CHECK(error, mask) rd_error_check(error, mask, __FILE__, __LINE__)</a>
<a name="ln84"> </a>
<a name="ln85">/*</a>
<a name="ln86"> * @brief reset global error flags and return their value.</a>
<a name="ln87"> *</a>
<a name="ln88"> * @return errors occured after last call to this function.</a>
<a name="ln89"> */</a>
<a name="ln90">rd_status_t rd_errors_clear();</a>
<a name="ln91"> </a>
<a name="ln92">/* @brief Application callback on error</a>
<a name="ln93"> *</a>
<a name="ln94"> * If this callback is set, it will get called on error.</a>
<a name="ln95"> *</a>
<a name="ln96"> * @param[in] error Type of error</a>
<a name="ln97"> * @param[in] fatal True if error is considered non-recoverable</a>
<a name="ln98"> * @param[in] file  Pointer to name of file where error occured</a>
<a name="ln99"> * @param[in] line  line where error occured</a>
<a name="ln100"> */</a>
<a name="ln101">typedef void (*rd_error_cb) (const rd_status_t error,</a>
<a name="ln102">                             const bool fatal,</a>
<a name="ln103">                             const char * file,</a>
<a name="ln104">                             const int line);</a>
<a name="ln105"> </a>
<a name="ln106">/**</a>
<a name="ln107"> * @brief Configure application callback for errors</a>
<a name="ln108"> *</a>
<a name="ln109"> * @param[in] cb Callback on error, NULL to clear callback</a>
<a name="ln110"> */</a>
<a name="ln111">void rd_error_cb_set (rd_error_cb cb);</a>
<a name="ln112"> </a>
<a name="ln113">/** @} */</a>
<a name="ln114">#endif</a>

</code></pre>
<div class="balloon" rel="90"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2601/" target="_blank">V2601</a> Functions should be declared in prototype form with named parameters.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
