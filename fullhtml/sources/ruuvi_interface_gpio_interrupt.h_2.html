
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ruuvi_interface_gpio_interrupt.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#ifndef RUUVI_INTERFACE_GPIO_INTERRUPT_H</a>
<a name="ln2">#define RUUVI_INTERFACE_GPIO_INTERRUPT_H</a>
<a name="ln3">/**</a>
<a name="ln4"> * @addtogroup GPIO</a>
<a name="ln5"> * @{</a>
<a name="ln6"> */</a>
<a name="ln7">/**</a>
<a name="ln8"> * @file ruuvi_interface_gpio_interrupt.h</a>
<a name="ln9"> * @author Otso Jousimaa &lt;otso@ojousima.net&gt;</a>
<a name="ln10"> * @date 2019-02-01</a>
<a name="ln11"> * @copyright Ruuvi Innovations Ltd, license BSD-3-Clause.</a>
<a name="ln12"> *</a>
<a name="ln13"> * Interface for basic GPIO interrupt functions</a>
<a name="ln14"> */</a>
<a name="ln15">#include &quot;ruuvi_driver_enabled_modules.h&quot;</a>
<a name="ln16">#include &quot;ruuvi_driver_error.h&quot;</a>
<a name="ln17">#include &quot;ruuvi_interface_gpio.h&quot;</a>
<a name="ln18">/** @brief Enable implementation selected by application */</a>
<a name="ln19">#if RI_GPIO_ENABLED</a>
<a name="ln20">#  define RUUVI_NRF5_SDK15_GPIO_INTERRUPT_ENABLED RUUVI_NRF5_SDK15_ENABLED</a>
<a name="ln21">#endif</a>
<a name="ln22"> </a>
<a name="ln23">/**</a>
<a name="ln24"> * Enumeration for GPIO slopes</a>
<a name="ln25"> */</a>
<a name="ln26">typedef enum</a>
<a name="ln27">{</a>
<a name="ln28">    RI_GPIO_SLOPE_HITOLO, /**&lt;  High to low transition */</a>
<a name="ln29">    RI_GPIO_SLOPE_LOTOHI, /**&lt;  Low to high transition */</a>
<a name="ln30">    RI_GPIO_SLOPE_TOGGLE, /**&lt;  Any transition */</a>
<a name="ln31">    RI_GPIO_SLOPE_UNKNOWN /**&lt;  Error or unknown value. */</a>
<a name="ln32">} ri_gpio_slope_t;</a>
<a name="ln33"> </a>
<a name="ln34">/**</a>
<a name="ln35"> * @brief Event from GPIO</a>
<a name="ln36"> */</a>
<a name="ln37">typedef struct</a>
<a name="ln38">{</a>
<a name="ln39">    /** @brief @ref ri_gpio_slope_t slope of event */</a>
<a name="ln40">    ri_gpio_slope_t slope;</a>
<a name="ln41">    /**@brief Pin of the event */</a>
<a name="ln42">    ri_gpio_id_t pin;</a>
<a name="ln43">} ri_gpio_evt_t;</a>
<a name="ln44"> </a>
<a name="ln45">typedef void (*ri_gpio_interrupt_fp_t) (const ri_gpio_evt_t);</a>
<a name="ln46"> </a>
<a name="ln47">/**</a>
<a name="ln48"> * @brief Initialize interrupt functionality to GPIO.</a>
<a name="ln49"> * Takes address of interrupt table as a pointer to avoid tying driver into a specific board with a specific number of GPIO</a>
<a name="ln50"> * pins and to avoid including boards repository within the driver. The interrupt table must be retained in the RAM.</a>
<a name="ln51"> *</a>
<a name="ln52"> * - Initialization must return @c RD_ERROR_INVALID_STATE if GPIO is uninitialized</a>
<a name="ln53"> * - Initialization must return @c RD_SUCCESS on first call.</a>
<a name="ln54"> * - Initialization must return @c RD_ERROR_INVALID_STATE on second call.</a>
<a name="ln55"> * - Initialization must return @c RD_SUCCESS after uninitializtion.</a>
<a name="ln56"> * - Initialization must return @c RD_ERROR_NULL if interrupt handler table is @c NULL.</a>
<a name="ln57"> *</a>
<a name="ln58"> * @param[in] interrupt_table Array of function pointers, initialized to all nulls. Size should be the number of GPIO+1, i.e. RUUVI_BOARD_GPIO_NUMBER + 1.</a>
<a name="ln59"> * @param[in] max_interrupts Size of interrupt table.</a>
<a name="ln60"> *</a>
<a name="ln61"> * @return @ref RD_SUCCESS on success, error code on failure.</a>
<a name="ln62"> */</a>
<a name="ln63">rd_status_t ri_gpio_interrupt_init (</a>
<a name="ln64">    ri_gpio_interrupt_fp_t * const interrupt_table, const uint16_t max_interrupts);</a>
<a name="ln65"> </a>
<a name="ln66">/**</a>
<a name="ln67"> * @brief Uninitialize interrupt functionality of GPIO.</a>
<a name="ln68"> *</a>
<a name="ln69"> * @return @ref RD_SUCCESS on success, error code on failure.</a>
<a name="ln70"> */</a>
<a name="ln71">rd_status_t ri_gpio_interrupt_uninit (void);</a>
<a name="ln72"> </a>
<a name="ln73">/**</a>
<a name="ln74"> * @brief Check if interrupt module is initialized</a>
<a name="ln75"> *</a>
<a name="ln76"> * @return @c true if module is initialized, false otherwise</a>
<a name="ln77"> */</a>
<a name="ln78">bool ri_gpio_interrupt_is_init (void);</a>
<a name="ln79"> </a>
<a name="ln80">/**</a>
<a name="ln81"> * @brief Enable interrupt on a pin.</a>
<a name="ln82"> *</a>
<a name="ln83"> * Underlying implementation is allowed to use same interrupt channel for all pin interrupts, i.e.</a>
<a name="ln84"> * simultaneous interrupts might get detected as one and the priority of interrupts is undefined.</a>
<a name="ln85"> *</a>
<a name="ln86"> * - Return RD_ERROR_INVALID_STATE if GPIO or GPIO_INTERRUPT are not initialized</a>
<a name="ln87"> * - Interrupt function shall be called exactly once when input is configured as low-to-high while input is low and</a>
<a name="ln88"> *   input goes low-to-high, high-to-low.</a>
<a name="ln89"> * - Interrupt function shall not be called after interrupt has been disabled</a>
<a name="ln90"> * - Interrupt function shall be called exactly once when input is configured as high-to-low while input is low and</a>
<a name="ln91"> *   input goes low-to-high, high-to-low.</a>
<a name="ln92"> * - Interrupt function shall be called exactly twice when input is configured as toggle while input is low and</a>
<a name="ln93"> *   input goes low-to-high, high-to-low.</a>
<a name="ln94"> * - Interrupt pin shall be at logic HIGH when interrupt is enabled with a pull-up and the pin is not loaded externally</a>
<a name="ln95"> * - Interrupt pin shall be at logic LOW when interrupt is enabled with a pull-down and the pin is not loaded externally</a>
<a name="ln96"> *</a>
<a name="ln97"> * @param[in] pin pin to use as interrupt source</a>
<a name="ln98"> * @param[in] slope slope to interrupt on</a>
<a name="ln99"> * @param[in] mode GPIO input mode. Must be (RI_GPIO_)INPUT_PULLUP, INPUT_PULLDOWN or INPUT_NOPULL</a>
<a name="ln100"> * @param[in] handler function pointer which will be called with ri_gpio_evt_t as a parameter on interrupt.</a>
<a name="ln101"> *</a>
<a name="ln102"> * @return @ref RD_SUCCESS on success, error code on failure.</a>
<a name="ln103"> * @warning Simultaneous interrupts may be lost. Check the underlying implementation.</a>
<a name="ln104"> */</a>
<a name="ln105">rd_status_t ri_gpio_interrupt_enable (const ri_gpio_id_t pin,</a>
<a name="ln106">                                      const ri_gpio_slope_t slope,</a>
<a name="ln107">                                      const ri_gpio_mode_t mode,</a>
<a name="ln108">                                      const ri_gpio_interrupt_fp_t handler);</a>
<a name="ln109"> </a>
<a name="ln110">/**</a>
<a name="ln111"> * @brief Disable interrupt on a pin.</a>
<a name="ln112"> *</a>
<a name="ln113"> * Pin will be left as @ref RI_GPIO_MODE_HIGH_Z.</a>
<a name="ln114"> *</a>
<a name="ln115"> * @param[in] pin pin to disable as interrupt source.</a>
<a name="ln116"> *</a>
<a name="ln117"> * @retval RD_SUCCESS on success.</a>
<a name="ln118"> </a>
<a name="ln119"> */</a>
<a name="ln120">rd_status_t ri_gpio_interrupt_disable (const ri_gpio_id_t pin);</a>
<a name="ln121"> </a>
<a name="ln122">/** @} */</a>
<a name="ln123"> </a>
<a name="ln124">#endif</a>

</code></pre>
<div class="balloon" rel="45"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v2601/" target="_blank">V2601</a> Functions should be declared in prototype form with named parameters.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
